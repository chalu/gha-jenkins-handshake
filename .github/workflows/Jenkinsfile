// #!/usr/bin/env groovy
// import net.sf.json.JSONArray;
// import net.sf.json.JSONObject;
// import hudson.model.Actionable;

pipeline {
  agent {
    label 'main'
  }

  stages {

    stage('Deploy to TESTING') {

        steps {

            httpRequest (
                httpMode: 'POST',
                requestBody: '''{
                  "ref": "develop",
                  "inputs": {
                    "environment": "testing"
                  }
                }''',
                consoleLogResponseBody: true,
                validResponseCodes: '200, 401',
                url: 'https://api.github.com/repos/chalu/gha-jenkins-handshake/actions/workflows/12145487/dispatches',
                customHeaders: [[name: 'Accept', value: 'application/vnd.github.v3+json'], [name: 'Authorization', value: 'token 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', maskValue: true]]
            )
        }
    }
    
  }

  post {
    always {
      cleanWs()
    }
  }
}
